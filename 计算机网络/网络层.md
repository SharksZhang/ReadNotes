## 网络层
#### 1.网络层提供的服务
**网络层提供什么样的服务？**
网络层向上层提供简单灵活，无连接，尽最大努力交付的数据包服务服务。

**为什么提供这样的服务**
1. 网络造价大大降低。网络层不提供服务质量的承诺，这使网络的路由器比较简单，且价格低廉。
2. 运行方式灵活，能够适应多种应用。将可靠传输的绝对权交给传输层，灵活适应上层协议。

#### 2. ip协议
##### 2.2.1 ip协议的价值
屏蔽异构网络的区别，在网络层看起来是一个统一的网络。没有单一的网络能够适应所有用户的需求，所以互联网是由多种异构网络互连，通过ip协议在网络层屏蔽底层网络的差异.
##### 2.2.2 分类ip地址
用的比较少，又复杂，先跳过。
##### 2.2.3 IP地址与MAC地址
物理地址是数据链路层和物理层使用的地址，IP地址是网络层以上各层使用的地址，是一种逻辑地址。

**ip地址与硬件地址的区别**
1. 网络层使用的是IP地址，但在实际网络的链路上传送数据帧时，最终还是必须使用该网络的硬件地址。
2. 在ip层抽象的互联网上只能看到IP数据报。
3. 路由表只根据目的站的IP地址的网络号进行路由
4. 在局域网的链路层，只能看见mac地址。
5. 互联在一起的硬件地址体系各不相同，单IP层抽象的互联网却屏蔽了下层这些很复杂的细节。

##### 2.2.4 ARP协议
**arp协议解决的问题**
已经知道了一个主机的ip地址，如何知道主机的mac地址。
**arp协议是什么**
在主机的ARP 高速缓存中存放一个从IP地址到硬件地址的映射表，并且动态更新这个表。

**arp协议的工作过程**
主机A要向本局域网上的主机b发送ip数据报时，先查其arp高速缓存表，如果查到，直接使用该mac，如果未查到，运行arp。
1. ARP进程在本局域网上广播ARP请求分组。
2. 在本局域网上的所有主机上运行的ARP进程都收到此ARP请求分组
3. 主机B的IP地址与ARP骑牛分组中要查询的IP地址一致，就收下这个ARP骑牛，并写入自己的本地高速缓存。其余不一致的主机，不理睬这个ARP请求分组。
4. 主机A收到主机b的ARP响应分组后，在就在ARP高速缓存中写入主机B的地址到硬件地址的映射。

arp高速缓存都设置生存时间，例如（10-20分钟）。
##### 2.2.5 IP数据报的格式
ip数据报由首部和数据部分组成，首部由 20字节的固定长度和可选部分组成
![ip数据报首部格式.png](.\ip数据报首部格式.png)
**第一个4字节：长度相关**
1. 版本（4为）
2. 首部长度（4位），首部长度以32为字（4字节）为单位。所以首部长度最小为20字节，最大为60字节。但一般首部长度不为4的整数倍时，会增加字节填充，所以当首部最长为60字节时，会增加4字节的填充。
3. 区分服务，一般情况下不使用。
4. 总长度（16位），数据报的最大长度为 2<sup>16</sup> -1=65535字节。一般不会使用这么长的长度。互联网中的主机必须576字节的数据报，512为上层的数据+64的最长首部。

**第二个4字节:分片相关**
1. 标识（16位），用于标识数据报，分片后可以重组


