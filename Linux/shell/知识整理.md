### shell的基本结构



~~~powershell
#!/bin/env bash

# 以下内容是对脚本的基本信息的描述
# Name: 名字
# Desc:描述describe
# Path:存放路径
# Usage:用法
# Update:更新时间

#下面就是脚本的具体内容
commands
...
~~~

1）**脚本第一行**，魔法字符==**#!**==指定解释器【==必写==】

`#!/bin/bash`  表示以下内容使用bash解释器解析

**注意：**
如果直接将解释器路径写死在脚本里，可能在某些系统就会存在找不到解释器的兼容性问题，所以可以使用:`#!/bin/env 解释器`

2）**脚本第二部分**，注释(#号)说明，对脚本的基本信息进行描述【可选】

3）**脚本第三部分**，脚本要实现的具体代码内容



### shell脚本的执行方法

1. ```
   ./first_shell.sh
   ```

2. 直接在命令行指定解释器执行

   ```
   bash first_shell.sh
   bash -x first_shell.sh
   + echo 'hello world'
   
   -x:一般用于排错，查看脚本的执行过程
   -n:用来查看脚本的语法是否有问题
   ```

3. 使用`source`命令读取脚本文件,执行文件里的代码，相当于当前终端执行

   ```
   source first_shell.sh
   hello world
   hello world
   hello world
   ```

   

### 变量

#### 变量的分类

##### 全局变量（global variable）

变量在当前的整个 Shell 进程中都有效。每个 Shell 进程都有自己的作用域，彼此之间互不影响。在 Shell 中定义的变量，默认就是全局变量。

```
#!/bin/bash
a=99
```

##### 环境变量（environment variable）

全局变量只在当前 Shell 进程中有效，对其它 Shell 进程和子进程都无效。如果使用`export`命令将全局变量导出，那么它就在所有的子进程中也有效了，这称为“环境变量”。

```
#!/bin/bash
export a=99
```

如果希望环境变量在整个系统中生效，可将其定义在一下文件中

| 文件名               | 说明                                    | 备注                                                       |
| -------------------- | --------------------------------------- | ---------------------------------------------------------- |
| $HOME/.bashrc        | 当前用户的bash信息,用户**登录**时读取   | 定义别名、umask、函数等                                    |
| $HOME/.bash_profile  | 当前用户的环境变量，用户**登录**时读取  |                                                            |
| $HOME/.bash_logout   | 当前用户==**退出**==当前shell时最后读取 | 定义用户退出时执行的程序等                                 |
| /etc/bashrc          | 全局的bash信息，所有用户都生效          |                                                            |
| /etc/profile         | 全局环境变量信息                        | 系统和所有用户都生效                                       |
| \$HOME/.bash_history | 用户的历史命令                          | history -w   保存历史记录         history -c  清空历史记录 |

**说明：**以上文件修改后，都需要重新==source==让其生效或者退出重新登录。

##### 局部变量（local variable)

变量只能在函数内部使用

```
#!/bin/bash
#定义函数
function func(){
    local a=99
}
#调用函数
func
#输出函数内部的变量
echo $a
```

Declaration and assignment must be separate statements when the assignment value is provided by a command substitution; as the `local` builtin does not propagate the exit code from the command substitution.

```
my_func2() {
  local name="$1"

  # Separate lines for declaration and assignment:
  local my_var
  my_var="$(my_func)"
  (( $? == 0 )) || return

  …
}
```

```
my_func2() {
  # DO NOT do this:
  # $? will always be zero, as it contains the exit code of 'local', not my_func
  local my_var="$(my_func)"
  (( $? == 0 )) || return

  …
}
```



##### 只读变量（readonly ）

Use the readonly command to make [variables](https://bash.cyberciti.biz/guide/Variables) and [functions](https://bash.cyberciti.biz/guide/Functions) readonly 

```
readonly var
readonly var=value
readonly p=/tmp/toi.txt
# error
p=/tmp/newvale

declare -r a
```

readonly and environment

```
declare -xr ORACLE_SID='PROD'
```

define constant 

```
readonly PATH_TO_FILES='/some/path'
```

Local readonly variable

```
Local -r a
```

#### Variable naming Convention

##### Variable Names

Lower-case, with underscores to separate words.

##### Constants and Environment Variable Names

All caps, separated with underscores, declared at the top of the file.

Constants and anything exported to the environment should be capitalized.



#### 变量的赋值方式

#### 查看变量

- `env`查看当前用户的环境变量
- `set`查询当前用户的所有变量(临时变量与环境变量) 
- `readonly` 查询当前只读变量

#### 变量的操作

##### 取出一个目录下的目录和文件：`dirname`和 `basename` 

```
# A=/root/Desktop/shell/mem.txt 
# echo $A
/root/Desktop/shell/mem.txt
# dirname $A   取出目录
/root/Desktop/shell
# basename $A  取出文件
mem.txt
```



##### 变量删除

一个“#”代表从左往右去掉一个/key/
两个“##”代表从左往右最大去掉/key/
一个“%”代表从右往左去掉一个/key/
两个“%%”代表从右往左最大去掉/key/

```
# url=www.taobao.com
# echo ${#url}		     14 获取变量的长度
# echo ${url#*.}       taobao.com
# echo ${url##*.}      com
# echo ${url%.*}       www.taobao
# echo ${url%%.*}      www
```

##### 变量替换

/：替换 

//：贪婪替换

```
#替换
echo ${url/ao/AO}     www.tAObao.com
#贪婪替换
echo ${url//ao/AO}    www.tAObAO.com
```

变量替代

1. ${变量名-新的变量值} 或者 ${变量名=新的变量值}
   变量没有被赋值：会使用“新的变量值“ 替代
   变量有被赋值（包括空值）： 不会被替代

```

```

2. ${变量名:-新的变量值} 或者 ${变量名:=新的变量值}
   变量没有被赋值或者赋空值：会使用“新的变量值“ 替代
   变量有被赋值： 不会被替代
3. ${变量名+新的变量值}
   变量没有被赋值或者赋空值：不会使用“新的变量值“ 替代
   变量有被赋值： 会被替代
4. ${变量名:+新的变量值}
   变量没有被赋值：不会使用“新的变量值“ 替代
   变量有被赋值（包括空值）： 会被替代
5. ${变量名?新的变量值}
   变量没有被赋值:提示错误信息
   ${变量名:?新的变量值}
   变量没有被赋值或者赋空值时:提示错误信息
   说明：?主要是当变量没有赋值提示错误信息的，没有赋值功能